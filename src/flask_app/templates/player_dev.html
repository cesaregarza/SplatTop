<!-- player.html -->
{% extends 'base.html' %} 
{% block posthead %}
<title>splat.top: {{ player_details.name }}</title>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/stock/modules/stock.js"></script>
<script src="{{ url_for('static', filename='js/highcharts_config.js') }}"></script>
{% endblock %}

{% block content %}
<div class="content full-height-desktop">
  <div class="container">
    <h1 class="title">Player Details</h1>

    <!-- Player General Information -->
    <section class="section">
      <div class="columns">
        <div class="column is-one-third">
          <div class="box">
            <h2 class="title is-4">General Information</h2>
            <p><strong>Name:</strong> {{ player_details.splashtag }}</p>
            <p><strong>Weapon:</strong> {{ player_details.weapon }}</p>
          </div>
        </div>

        <!-- Player Aliases -->
        <div class="column is-one-third">
          <div class="box">
            <h2 class="title is-4">Aliases</h2>
            {% if aliases_data %}
            <ul>
              {% for alias in aliases_data %}
              <li>{{ alias.alias }} (Last seen: {{ alias.last_updated }})</li>
              {% endfor %}
            </ul>
            {% else %}
            <p>No aliases found.</p>
            {% endif %}
          </div>
        </div>

        <!-- Peak Data -->
        <div class="column is-one-third">
          <div class="box">
            <h2 class="title is-4">Peak Data</h2>
            <table class="table is-striped is-fullwidth">
              <thead>
                <tr>
                  <th>Mode</th>
                  <th>Peak X Power</th>
                  <th>Peak Rank</th>
                </tr>
              </thead>
              <tbody>
                {% for data in peak_data %}
                <tr>
                  <td>{{ data.mode }}</td>
                  <td>{{ data.peak_xpower.x_power }} ({{ data.peak_xpower.timestamp }})</td>
                  <td>{{ data.peak_rank.rank }} ({{ data.peak_rank.timestamp }})</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Player Stats by Mode -->
    <section class="section">
      <h2 class="title is-4">Player Stats by Mode</h2>
      <div class="tabs">
        <ul>
          {% for mode in modes %}
          <li {% if loop.first %}class="is-active"{% endif %}>
            <a href="#{{ mode }}">{{ mode }}</a>
          </li>
          {% endfor %}
        </ul>
      </div>

      {% for mode in modes %}
      <div id="{{ mode }}" class="tab-content" {% if not loop.first %}style="display: none;"{% endif %}>
        <div class="columns">
          <div class="column is-one-third">
            <div class="box">
              <h3 class="title is-5">Current Stats</h3>
              <p><strong>X Power:</strong> {{ player_details[mode].x_power }}</p>
              <p><strong>Rank:</strong> {{ player_details[mode].rank }}</p>
              <p><strong>Weapon:</strong> {{ player_details[mode].weapon }}</p>
            </div>
          </div>
          <div class="column is-two-thirds">
            <div class="box">
              <h3 class="title is-5">Historical Data</h3>
              <div id="chart-{{ mode }}"></div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </section>
  </div>
</div>

<script>
  // JavaScript code to handle tab switching and chart rendering
  const tabs = document.querySelectorAll('.tabs li');
  const tabContents = document.querySelectorAll('.tab-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const target = tab.querySelector('a').getAttribute('href');

      tabs.forEach(t => t.classList.remove('is-active'));
      tab.classList.add('is-active');

      tabContents.forEach(content => {
        content.style.display = content.id === target.slice(1) ? 'block' : 'none';
      });
    });
  });

  // Render historical data charts for each mode
  {% for mode in modes %}
  Highcharts.chart('chart-{{ mode }}', {
    // Chart configuration for historical data
    // Use the data from historical_data[mode]
  });
  {% endfor %}
</script>
{% endblock %}